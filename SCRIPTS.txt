Agregar columna ULTIMO_ENVIO (date);
Agregar columna CONTRASENIA VARCHAR2(60 BYTE)
Agregar FRECOMPRAS para el API

CREATE TABLE "FRECUENTE"."FRECOMPRAS"
   (	"CEDULA" VARCHAR2(20 BYTE) NOT NULL ENABLE,
	"CONSUMOPUNTOS" NUMBER(14,2) NOT NULL ENABLE,
	"FECHA" DATE NOT NULL ENABLE,
	"ESTADO" CHAR(3 BYTE) DEFAULT 'P' NOT NULL ENABLE
   ) SEGMENT CREATION IMMEDIATE
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "DATOS" ;

CREATE TABLE "FRECUENTE"."FRESUCURSAL"
   (	"COD_CIA" CHAR(3 BYTE) NOT NULL ENABLE,
	"SUCURSAL" CHAR(3 BYTE) NOT NULL ENABLE,
	"DESCRIPCION" VARCHAR2(60 BYTE) NOT NULL ENABLE,
	"DES_DIRECCION" VARCHAR2(50 BYTE),
	"NUM_TELEFONO1" VARCHAR2(16 BYTE),
	"NUM_TELEFONO2" VARCHAR2(16 BYTE),
	"EMAIL" VARCHAR2(30 BYTE),
	"AREA" NUMBER(12,2),
	"MTS_EXHIBE" NUMBER(12,2),
	"CARACTERISTICAS" VARCHAR2(256 BYTE),
	"CLIENTELANCO" VARCHAR2(25 BYTE),
	"ESTADO" CHAR(1 BYTE) DEFAULT 'A' NOT NULL ENABLE,
	"ALIAS" VARCHAR2(25 BYTE),
	 CONSTRAINT "FRESUCURSAL_PK" PRIMARY KEY ("COD_CIA", "SUCURSAL")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "DATOS"  ENABLE
   ) SEGMENT CREATION IMMEDIATE
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "DATOS" ;


CREATE OR REPLACE VIEW FREPUNTOSV
(CIA, CLIENTE, PUNTOSOBT, PUNTOSTRA, COMPRASTRA,
 PUNTOSCAM, ULTIMACOMPRA, TOTALCOMPRAS, TOTALOBSEQUIO)
AS
Select Cia, Cliente,
          Sum(Decode(Origen, 'F', Puntos, 'ND', Puntos, 'P', 0, 'V', 0, -Puntos)) PuntosObt,
          Sum(PuntosTra) PuntosTra,
          Sum(Decode(PuntosTra, 0, 0, Monto+Impuesto-MontoPago)) ComprasTra,
          Sum(Decode(Origen, 'P', Puntos, 'V', Puntos, 0)) PuntosCam,
          Max(Decode(Origen, 'F', Fecha, Null)) UltimaCompra,
          Sum(Decode(Origen, 'F', Monto+Impuesto, 'ND', Monto+Impuesto,
                     'P', 0, 'V', 0, -Monto-Impuesto)) TotalCompras,
          Sum(Decode(Origen, 'P', Monto, 'V', Monto, 0)) TotalObsequio
   From FrePuntos
   Group by Cia, Cliente


#################TO DO#####################################

->PDF del ADMIN
->Envio de correos de ayuda
->Revisar lo de los puntos disponibles y bloqueados que se hace con FREPUNTOS para
cada compra y con FREPUNTOSV para el total


usuario nuevolcr201
